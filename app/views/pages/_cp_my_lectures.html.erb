<% n_avail = @lectures[:availables].count %>
<% n_not_avail = @lectures[:not_availables].count %>
<% n_conf = @lectures_bookings[:confirmed].count %>
<% n_not_conf = @lectures_bookings[:not_confirmed].count %>

<% def booking_params(booking, confirmation = false) %>
  <% booking_params = { lecture_id: booking.availability.lecture.id,
                        availability_id: booking.availability.id,
                        id: booking.id,
                        confirmation: confirmation } %>  
<% end %>


<div class="row">
  <div class="col col-6">
    <h3>Com horários inclusos (<%= n_avail.positive? ? n_avail : 0 %>)</h3>
    <hr>
    <% if n_avail.positive? %>
      <% @lectures[:availables].each do |lecture| %>
        <p><%= link_to "#{lecture.title}", lecture_path(lecture) %></p>
      <% end %>
    <% else %>
      <p>Você ainda não disponibilizou horários para suas aulas.</p>
    <% end %>
  </div>
  <div class="col col-6">
    <h3>Sem horário agendado(<%= n_not_avail.positive? ? n_avail : 0 %>)</h3>
    <hr>
    <% if n_not_avail.positive? %>
      <% @lectures[:not_availables].each do |lecture| %>
        <p><%= link_to "#{lecture.title}", lecture_path(lecture) %></p>
      <% end %>
    <% else %>
      <p>Você já incluiu horários para todas as suas aulas.</p>
    <% end %>           
  </div>
</div>
<div class="row">
  <div class="col col-6">
    <h3>Agendamentos que confirmei (<%= n_conf.positive? ? n_conf : 0 %>)</h3>
    <hr>
    <% if n_conf.positive? %>
      <% @lectures_bookings[:confirmed].each do |booking| %>
        <p>
          <%= link_to "Confirmar", lecture_availability_booking_path(booking_params(booking, true)),
                                   method: :patch,
                                   data: { confirm: "Confirmar agendamento?"
                                   } %> |
          <%= link_to "Negar", lecture_availability_booking_path(booking_params(booking, false)),
                                   method: :patch,
                                   data: { confirm: "Negar agendamento?" } %> |
          <%= booking.availability.lecture.title %>
           Aula: <%= link_to "#{booking.availability.lecture.title}",  
                        lecture_availability_booking_path(booking_params(booking)) %> |
           Horário: <%= booking.availability.start_time %>             
        </p>
      <% end %>
    <% else %>
      <p>Você não confirmou agendamentos.</p>
    <% end %>              
  </div>
  <div class="col col-6">
    <h3>Agendamentos que não confirmei (<%= n_not_conf.positive? ? n_not_conf : 0 %>)</h3>
    <hr>
    <% if n_not_conf.positive? %>
      <% @lectures_bookings[:not_confirmed].each do |booking| %>
        <p>
          <%= link_to "Confirmar", lecture_availability_booking_path(booking_params(booking, true)),
                                   method: :patch,
                                   confirmation: true,
                                   data: { confirm: "Confirmar agendamento?" } %> |
          <%= link_to "Negar", lecture_availability_booking_path(booking_params(booking, false)),
                                   method: :patch,
                                   data: { confirm: "Negar agendamento?" } %> |
          Aula: <%= link_to "#{booking.availability.lecture.title}",
                       lecture_availability_booking_path(booking_params(booking)) %> |
          Horário: <%= booking.availability.start_time %>
        </p>
      <% end %>
    <% else %>
      <p>Você não tem agendamentos com confirmação pendente.</p>
    <% end %>             
  </div>
</div>